<div class="row">
  <div class="col-md-8 push-md-2">
    <div class="card">
      <div class="card-header">
        Timesheets
      </div>
      <div class="card-block">
        <div class="form-group row">
            <h5 class="col-md-1">Period</h5>
            <select (change)="selectPeriod.emit($event.target.value)" [(ngModel)]="periodId" class="form-control col-md-3">
              <option [value]="0">none</option>
              <option [value]="period.Id" *ngFor="let period of periods">{{period.PeriodStart | date: 'EEE d-MMM'}} to {{period.PeriodEnd | date: 'EEE d-MMM'}}</option>
            </select>
        </div>
        <div *ngIf="isLoaded && timesheets != null" class="form-group">
          <div *ngFor="let line of timesheets.Lines; let i = index">
            <div class="row form-group timego-line">
              <h5 class="col-md-2 timego-center">{{line.Date | date: 'EEE d-MMM'}}</h5>
              <div class="col-md-4">
                <select [(ngModel)]="line.TaskId" class="form-control col-md-8">
                  <option [value]="0">none</option>
                  <option [value]="task.Id" *ngFor="let task of tasks">{{task.TaskName}}</option>
                </select>
              </div>
              <div class="col-md-4 row">
                <timepicker [(ngModel)]="line.StartTime" [arrowkeys]="true" [showMeridian]="false" [mousewheel]="false" [showSpinners]="false" class="timego-timepicker"></timepicker>
                <i class="fa fa-arrows-h fa-lg timego-rangetimepiker-icon"></i>
                <timepicker [(ngModel)]="line.EndTime" [min]="line.StartTime" [mousewheel]="false" [showMeridian]="false" [arrowkeys]="false" [showSpinners]="false" class="timego-timepicker"></timepicker>
              </div>
              <div class="col-md-2 timego-center">
                <b>
                  {{totalLineTimeHr(line)}} h {{totalLineTimeMin(line)}} m
                </b>
              </div>
            </div>
            <div class="row form-group border-bottom" *ngIf="i === (timesheets.Lines.length - 1) || timesheets.Lines[i].Date != timesheets.Lines[i+1].Date">
              <div class="col-md-1">
                <button type="button" class="btn btn-outline-primary" (click)="addLine.emit(line.Date)">+</button>
              </div>
              <div class="col-md-4 timego-center">
                add another line for {{line.Date | date: 'EEE d-MMM'}}
              </div>
            </div>
          </div>
          <div class="col-md-4 row form-group" *ngIf="isLoaded">
            <h5>
              Total time: {{totalTimeHr(timesheets.Lines)}} h {{totalTimeMin(timesheets.Lines)}} m
            </h5>
          </div>
          <div class="row form-group" *ngIf="isLoaded">
            <label class="col-md-1">Notes: </label>
            <textarea rows="4" class="col-md-7" cols="50" [(ngModel)]="timesheets.EmployeeNotes"></textarea>
          </div>
          <div class="row col-md-2 form-group">
            <button type="button" class="btn btn-primary" (click)="save.emit({Period: periodId, Timesheets: timesheets})">Save</button>
          </div>
        </div>
      </div>
    </div>
  </div>
